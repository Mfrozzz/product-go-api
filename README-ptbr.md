# Product API - Go lang

API RESTful para gerenciamento de produtos e usu√°rios, desenvolvida em Go com Gin, PostgreSQL e arquitetura limpa. Suporta autentica√ß√£o JWT, controle de permiss√µes por role (admin/user), rate limiting, e est√° pronta para uso com Docker.

## Sum√°rio üìã
* [Requisitos](#requirements)
* [Configurando Ambiente](#setting-up-the-environment)
* [Middlewares](#middlewares)
* [Endpoints](#endpoints)
* [Scripts](#scripts)
* [Arquitetura do Sistema](#architecture)
* [Estrutura de Pastas](#folder-structure)
* [Links √öteis](#useful-links)
* [Vers√£o EN-US](README.md)

---

## <div id="requirements">Requisitos üìÑ</div>

- Go 1.24.3 ou 1.20+
- Docker
- PostgreSQL
- Insomnia ou Postman

---

## <div id="setting-up-the-environment">Configurando Ambiente ‚öôÔ∏è</div>

### <div>Reposit√≥rio</div>

1. **Clone o reposit√≥rio:**

   ```sh
   git clone https://github.com/Mfrozzz/product-go-api.git
   cd product-go-api
   ```

2. **Consigure o arquivo `.env`:**

    * Copie o arquivo `.env.example` para `.env` e preencha com as suas configura√ß√µes:

    ```sh
    cp .env.example .env
    ```

    * Exemplo do arquivo:

    ```.env
    JWT_SECRET="YOUR-SECRET-KEY"
    PORT=":8000"

    DB_HOST="go_db"
    DB_PORT=5432
    DB_USER="YOUR-DATABASE-USER"
    DB_PASSWORD="YOUR-DATABASE-PASSWORD"
    DB_NAME="YOUR-DATABASE-NAME"
    ```

    * **Importante:** O projeto depende das vari√°veis do `.env` para conectar ao banco e gerar tokens JWT.

3. **Instale as depend√™ncias Go:**
  ```sh
  go mod tidy
  ```

---

### <div>Docker</div>

* Para subir os containers execute:

```sh
docker compose up -d
```

* Para realizar a build dos containers execute:

```
docker build -t product-go-api .
```

---

### <div>Banco de Dados</div>

A escolha da ferramenta para gerenciar o banco de dados fica a crit√©rio do desenvolvedor, podendo ser utilizado, por exemplo, o DBeaver ou outro software de sua prefer√™ncia. No entanto, neste caso, o acesso ao banco ser√° demonstrado via linha de comando, acessando diretamente o container Docker onde o banco de dados est√° em execu√ß√£o.

* Acesso ao Banco de dados:

```sh
docker exec -it go_db bash
psql -d postgres -U postgres
```

* Criar Tabelas no Banco de dados:

```sh
CREATE TABLE product (
  id SERIAL PRIMARY KEY,
  product_name VARCHAR(50) NOT NULL,
  price NUMERIC(10, 2) NOT NULL
);
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(20) NOT NULL DEFAULT 'user'
);
```

### <div>Dica: Como criar um usu√°rio admin ‚úâÔ∏è</div>

Para transformar um usu√°rio em admin diretamente pelo banco de dados, execute:

```sh
UPDATE users SET role = 'admin' WHERE id = 1;
```

---

## <div id="middlewares">Middlewares ‚ÜîÔ∏è</div>

O projeto utiliza tr√™s middlewares principais para garantir seguran√ßa, controle de acesso e limita√ß√£o de requisi√ß√µes:

### <div id="auth-middleware">1. **Auth Middleware**</div>

Respons√°vel por validar o token JWT enviado no header `Authorization`.  
- S√≥ vai permitir que o usu√°rio tenha acesso √†s rotas caso esteja autenticado (realizado o login).
- Se o token for v√°lido, extrai o campo `role` das claims e armazena no contexto da requisi√ß√£o (`ctx.Set("role", role)`), permitindo que outros middlewares e handlers saibam o papel do usu√°rio autenticado.
- Se o token estiver ausente ou inv√°lido, retorna erro 401 (Unauthorized).

### <div id="rate-limiter">2. **Rate Limiter Middleware**</div>

Limita o n√∫mero de requisi√ß√µes por IP para evitar abusos (rate limiting).
- Cada IP pode fazer at√© 3 requisi√ß√µes por segundo, com um burst m√°ximo de 5.
- Se o limite for excedido, retorna erro 429 (Too Many Requests).

### <div id="require-admin">3. **Require Admin Middleware**</div>

Garante que apenas usu√°rios com papel de admin possam acessar determinadas rotas.
- Verifica o campo `role` no contexto da requisi√ß√£o.
- Se o usu√°rio n√£o for admin, retorna erro 401 (Unauthorized) e bloqueia o acesso √† rota.

---

## <div id="endpoints">Endpoints üìå</div>

### <div>Produtos</div>

#### POST `/api/products`

Registra no sistema um novo produto.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)

- Request Body:
  ```json
  {
    "name": "Potato",
    "price": 4.45
  }
  ```

- Response:
  ```json
  {
    "id_product": 1,
    "name": "Potato",
    "price": 4.45
  }
  ```

#### GET `/api/products`

Faz a listagem de todos os produtos do banco de dados.
Pode ser usado par√¢metros, filtros e pagina√ß√£o nos resultados

- **Par√¢metros de Busca**:
  - `page` (opcional): N√∫mero da p√°gina, valor padr√£o = 1
  - `limit` (opcional): N√∫mero de itens por p√°gina, valor padr√£o = 10
  - `name` (opcional): Filtro pelo nome do produto

- **Exemplos**:
  - Listar todos os produtos (padr√£o):
  ```
  GET /api/products
  ```
  - Listar produtos com pagina√ß√£o, limite e filtro por nome:
  ```
  GET /api/products?page=1&limit=5&name=Potato
  ```

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)

- Response:
  ```json
  [
    {
      "id_product": 1,
      "name": "Potato",
      "price": 4.45
    },
    {
      "id_product": 9,
      "name": "Potato Chips",
      "price": 9
    }
    ...
  ]
  ```

#### GET `/api/products/:id_product`

Obt√©m as informa√ß√µes de um produto espec√≠fico.

- Path Params:
  - `id_product`: O ID do produto.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)

- Response:
  ```json
  {
    "id_product": 1,
    "name": "Potato",
    "price": 4.45
  }
  ```

#### PUT `/api/products/:id_product`

Atualiza as informa√ß√µes de um produto espec√≠fico.

- Path Params:
  - `id_product`: O ID do produto.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)

- Objeto antes da atualiza√ß√£o:
  ```json
  {
    "id_product": 14,
    "name": "Pasta",
    "price": 10.2
  }
  ```

- Request Body:
  ```json
  {
    "name": "Spaghetti Pasta",
    "price": 13.2
  }
  ```

- Response:
  ```json
  {
    "id_product": 14,
    "name": "Spaghetti Pasta",
    "price": 13.2
  }
  ```

- Observa√ß√µes:
  - Campos n√£o enviados no JSON permanecem inalterados.


#### DELETE `/api/admin/products/:id_product`

Apenas administradores podem acessar esse endpoint e excluir um produto do banco de dados.

- Path Params:
  - `id_product`: O ID do produto.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)
  - [Require Admin](#require-admin)

- Response:
  ```json
  {
    "Message": "Product deleted successfully"
  }
  ```

---

### <div>Usu√°rios</div>

#### POST `/register`

Registra um novo usu√°rio.

- Request Body:
  ```json
  {
    "username":"Test Example",
    "email": "user@example.com",
    "password": "password123"
  }
  ```

- Response:
  ```json
  {
    "Message": "Register successful",
    "User": {
      "email": "user@example.com",
      "role": "user",
      "user_id": 1,
      "username":"Test Example"
    }
  }
  ```

#### POST `/login`

Autentica um usu√°rio e retorna um token JWT.

- Request Body:
  ```json
  {
    "email": "user@example.com",
    "password": "password123"
  }
  ```

- Response:
  ```json
  {
    "Message": "Login successful",
    "token": "your_jwt_token"
  }
  ```

#### GET `/api/users/:id_user`

Obt√©m as informa√ß√µes de um usu√°rio espec√≠fico.

- Path Params:
  - `id_user`: O ID do usu√°rio.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)

- Response:
  ```json
  {
    "id_user": 1,
    "username":"Test Example",
    "email": "user@example.com",
    "password": "your_encrypted_password",
    "role": "user"
  }
  ```

#### GET `/api/user/info`

Retorna as informa√ß√µes do usu√°rio autenticado (baseado no Token JWT).

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)

- Response:
  ```json
  {
    "id_user": 1,
    "username":"Test Example",
    "email": "user@example.com",
    "password": "your_encrypted_password",
    "role": "user"
  }
  ```

#### GET `/api/admin/users`

Retorna todos os usu√°rios do banco de dados. Pode ser usado par√¢metros, filtros e pagina√ß√£o nos resultados

- **Par√¢metros de Busca**:
  - `page` (opcional): N√∫mero da p√°gina, valor padr√£o = 1
  - `limit` (opcional): N√∫mero de itens por p√°gina, valor padr√£o = 10
  - `name` (opcional): Filtro pelo nome do usu√°rio

- **Exemplos**:
  - Listar todos os usu√°rios (padr√£o):
  ```
  GET /api/admin/users
  ```
  - Listar usu√°rios com pagina√ß√£o, limite e filtro por nome:
  ```
  GET /api/admin/users?page=1&limit=5&name=user
  ```

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)
  - [Require Admin](#require-admin)

- Response:
  ```json
  [
    {
      "id_user": 1,
      "username":"Test Example",
      "email": "user@example.com",
      "password": "your_encrypted_password",
      "role": "user"
    },
    {
      "id_user": 2,
      "username":"Test Example 2",
      "email": "user2@example.com",
      "password": "your_encrypted_password",
      "role": "user2"
    }
    ...
  ]
  ```

#### PUT `/api/users/:id_user`

Atualiza as informa√ß√µes de um usu√°rio espec√≠fico.

- Qualquer usu√°rio autenticado pode atualizar seus pr√≥prios dados (username, email, password).
- Apenas administradores podem alterar o campo `role` de qualquer usu√°rio.

- Path Params:
  - `id_user`: O ID do usu√°rio.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)
  - [Require Admin](#require-admin)

- Objeto antes da atualiza√ß√£o:
```json
  {
    "id_user": 1,
    "username": "Name",
    "email": "email@example.com",
    "password": "Password123",
    "role": "user"
  }
```

- Request Body:
  ```json
  {
    "username": "New Name",
    "email": "newemail@example.com",
    "password": "newPassword123",
    "role": "admin" // S√≥ ser√° atualizado se o usu√°rio autenticado for admin
  }
  ```

- Response:
  ```json
  {
    "id_user": 1,
    "username":"New Name",
    "email": "newemail@example.com",
    "password": "your_new_encrypted_password",
    "role": "admin"
  }
  ```

- Observa√ß√µes:
  - Se um usu√°rio comum tentar alterar o campo role, receber√° erro 403 (Forbidden).
  - Campos n√£o enviados no JSON permanecem inalterados.
  - O campo password sempre ser√° salvo de forma criptografada.

#### DELETE `/api/admin/users/:id_user`

Apenas administradores podem acessar esse endpoint e excluir um usu√°rio do banco de dados.

- Path Params:
  - `id_user`: O ID do usu√°rio.

- Headers:
  - `Authorization`: Bearer `jwt_token`

- Middlewares Aplicados:
  - [Auth Middleware](#auth-middleware)
  - [Require Admin](#require-admin)

- Response:
  ```json
  {
    "Message": "User deleted successfully"
  }
  ```

---

## <div id="scripts">Scripts ‚å®Ô∏è</div>

### <div>Para iniciar</div>

```sh
docker compose up -d
```

ou

```sh
cd product-go-api/cmd
go run main.go
```

---

### <div>Para fazer Build</div>

```sh
docker build -t product-go-api .
```

ou

```sh
cd product-go-api/cmd
go build -o main cmd/main.go
```

---

## <div id="architecture">Arquitetura do sistema üèõÔ∏è</div>

A arquitetura do sistema segue o padr√£o Clean Architecture, separando claramente as responsabilidades em camadas. Isso facilita a manuten√ß√£o, testes e evolu√ß√£o do projeto.

```
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ Controllers (Gin HTTP handler)‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ   Usecase (Regras de neg√≥cio) ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ Repository (Acesso a dados)   ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ      Model (Entidades)        ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ   Database (PostgreSQL)       ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## <div id="folder-structure">Estrutura de Pastas üìÅ</div>

```
product-go-api/
‚îú‚îÄ‚îÄ cmd/
|   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ controller/
|   ‚îú‚îÄ‚îÄ product_controller.go
|   ‚îî‚îÄ‚îÄ user_controller.go
‚îú‚îÄ‚îÄ db/
|   ‚îî‚îÄ‚îÄ connection.go
‚îú‚îÄ‚îÄ middleware
|   ‚îú‚îÄ‚îÄ authMiddleware.go
|   ‚îú‚îÄ‚îÄ rateLimiter.go
|   ‚îî‚îÄ‚îÄ requireAdmin.go
‚îú‚îÄ‚îÄ model/
|   ‚îú‚îÄ‚îÄ product.go
|   ‚îú‚îÄ‚îÄ response.go
|   ‚îî‚îÄ‚îÄ user.go
‚îú‚îÄ‚îÄ repository/
|   ‚îú‚îÄ‚îÄ product_repository.go
|   ‚îî‚îÄ‚îÄ user_repository.go
‚îú‚îÄ‚îÄ usecase/
|   ‚îú‚îÄ‚îÄ product_usecase.go
|   ‚îî‚îÄ‚îÄ user_usecase.go
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go.sum
‚îú‚îÄ‚îÄ README-ptbr.md
‚îî‚îÄ‚îÄ README.md
```

---

## <div id="useful-links">Links √öteis üîó</div>

- [Documenta√ß√£o Oficial do Go (Golang)](https://golang.org/doc/)
- [Refer√™ncia de m√≥dulos Go](https://blog.golang.org/using-go-modules)
- [Documenta√ß√£o do Gin Web Framework](https://gin-gonic.com/en/docs/)
- [Documenta√ß√£o do Docker](https://docs.docker.com/)
- [Documenta√ß√£o Oficial do PostgreSQL](https://www.postgresql.org/docs/)
- [Introdu√ß√£o ao JWT](https://jwt.io/introduction)
- [Insomnia](https://insomnia.rest/) / [Postman](https://www.postman.com/) ‚Äî Ferramentas de testes de API

---

Desenvolvido por [Marcos Vinicius Boava](https://github.com/Mfrozzz), usando como base [Go Lab Tutoriais](https://www.youtube.com/watch?v=3p4mpId_ZU8&t=3317s).